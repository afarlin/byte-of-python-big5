#運算符與運算式 {#op-exp}

你所編寫的大多數語句（邏輯行）都包含了_運算式（Expressions）_。一個運算式的簡單例子便是 `2+3`。運算式可以拆分成運算符（Operators）與運算元（Operands）。

_運算符（Operators）_是進行某些操作，並且可以用諸如 `+` 等符號或特殊關鍵字加以表達的功能。運算符需要一些資料來進行操作，這些資料就被稱作_運算元（Operands）_。在上面的例子中 `2` 和 `3` 就是運算元。

## 運算符

接下來我們將簡要了解各類運算符及它們的用法。

要記得你可以隨時在解釋器中對給出的案例里的運算式進行求值。例如要想測試運算式 `2+3`，則可以使用交互式 Python 解釋器提示符：

```python
>>> 2 + 3
5
>>> 3 * 5
15
>>>
```

下面是可用運算符的速覽：

- `+`（加）
    - 兩個物件相加。
    - `3+5` 則輸出 `8`。`'a' + 'b'` 則輸出 `'ab'`。

- `-`（減）
    - 從一個數中減去另一個數，如果第一個運算元不存在，則假定為零。
    - `-5.2` 將輸出一個負數，`50 - 24` 輸出 `26`。

- `*`（乘）
    - 給出兩個數的乘積，或返回字串重複指定次數後的結果。
    - `2 * 3` 輸出 `6`。`'la' * 3` 輸出 `'lalala'`。

- `**` （乘方）
    - 返回 x 的 y 次方。
    - `3 ** 4` 輸出 `81` （即 `3 * 3 * 3 * 3`）。

- `/` （除）
    - x 除以 y
    - `13 / 3` 輸出 `4.333333333333333`。

- `//` （整除）
    - x 除以 y 並對結果_向下_取整至最接近的整數。
    - `13 // 3` 輸出 `4`。
    - `-13 // 3` 輸出 `-5`。

- `%` （取模）
    - 返回除法運算後的余數。
    - `13 % 3` 輸出 `1`。`-25.5 % 2.25` 輸出 `1.5`。

- `<<` （左移）
    - 將數字的位向左移動指定的位數。（每個數字在記憶體中以二進制數表示，即 0 和1）
    - `2 << 2` 輸出 `8`。 `2` 用二進制數表示為 `10`。
    - 向左移 2 位會得到 `1000` 這一結果，表示十進制中的 `8`。

- `>>` （右移）
    - 將數字的位向右移動指定的位數。
    - `11 >> 1` 輸出 `5`。
    - `11` 在二進制中表示為 `1011`，右移一位後輸出 `101` 這一結果，表示十進制中的 `5`。

- `&` （按位與）
    - 對數字進行按位與操作。[^1]
    - `5 & 3` 輸出 `1`。

- `|` （按位或）
    - 對數字進行按位或操作。[^2]
    - `5 | 3` 輸出 `7`。

- `^`（按位異或）
    - 對數字進行按位異或操作。[^3]
    - `5 ^ 3` 輸出 `6`。

- `~` （按位取反）[^4]
    - x 的按位取反結果為 -(x+1)。
    - `~5` 輸出 `-6`。有關本例的更多細節可以參閱：http://stackoverflow.com/a/11810203。

- `<` （小于）
    - 返回 x 是否小于 y。所有的比較運算符返回的結果均為 `True` 或 `False`。請注意這些名稱之中的大寫字母。
    - `5 < 3` 輸出 `False`，`3 < 6` 輸出 `True`。
    - 比較可以任意組成組成鏈結：`3 < 5 < 7` 返回 `True`。

- `>` （大于）
    - 返回 x 是否大于 y。
    - `5 > 3` 返回 `True`。如果兩個運算元均為數字，它們首先將會被轉換至一種共同的類型。否則，它將總是返回 `False`。

- `<=` （小于等于）
    - 返回 x 是否小于或等于 y。
    - `x = 3; y = 6; x<=y` 返回 `True`。

- `>=` （大于等于）
    - 返回 x 是否大于或等于 y。
    - `x = 4; y = 3; x>=3` 返回 `True`。

- `==` （等于）
    - 比較兩個物件是否相等。
    - `x = 2; y = 2; x == y` 返回 `True`。
    - `x = 'str'; y = 'stR'; x == y` 返回 `False`。
    - `x = 'str'; y = 'str'; x == y` 返回 `True`。

- `!=` （不等于）
    - 比較兩個物件是否不相等。
    - `x = 2; y = 3; x != y` 返回 `True`。

- `not` （布爾『非』）[^5]
    - 如果 x 是 `Ture`，則返回 `False`。如果 x 是 `False`，則返回 `True`。
    - `x = Ture; not x` 返回 `False`。

- `and` （布爾『與』）[^6]
    - 如果 x 是 `False`，則 `x and y` 返回 `False`，否則返回 y 的計算值。
    - 當 x 是 `False` 時，`x = False; y = True; x and y` 將返回 `False`。在這一情境中，Python 將不會計算 y，因為它已經了解 and 運算式的左側是 `False`，這意味著整個運算式都將是 `False` 而不會是別的值。這種情況被稱作短路計算（Short-circuit Evaluation）。

- `or`（布爾『或』）[^7]
    - 如果 x 是 `True`，則返回 `True`，否則它將返回 y 的計算值。
    - `x = Ture; y = False; x or y` 將返回 `Ture`。在這里短路計算同樣適用。

## 數值運算與賦值的捷徑

一種比較常見的操作是對一個變量進行一項數學運算並將運算得出的結果返回給這個變量，因此對于這類運算通常有如下的快捷表達方式：

```python
a = 2
a = a * 3
```

同樣也可寫作：

```python
a = 2
a *= 3
```

要注意到 `變量 = 變量 運算 運算式` 會演變成 `變量 運算 = 運算式`。

## 計算命令[^8]

如果你有一個諸如 `2 + 3 * 4` 的運算式，是優先完成加法還是優先完成乘法呢？我們的高中數學知識會告訴我們應該先完成乘法。這意味著乘法運算符的優先級要高于加法運算符。

下面將給出 Python 中從最低優先級（最少綁定）到最高優先級（最多綁定）的優先級表。這意味著，在給定的運算式中，Python 將優先計算表中位列于後的較高優先級的運算符與運算式。

為了保持完整，下表是從 [Python 參考手冊](http://docs.python.org/3/reference/expressions.html#operator-precedence) 中引用而來。你最好使用圓括弧操作符來對運算符與運算元進行分組，以更加明確地指定優先級。這也能使得程式更加可讀。你可以閱讀[改變運算順序](#changing-order-of-evaluation)來了解更多的細節。

- `lambda`：Lambda 運算式
- `if - else` ：條件運算式
- `or`：布爾『或』
- `and`：布爾『與』
- `not x`：布爾『非』
- `in, not in, is, is not, <, <=, >, >=, !=, ==`：比較，包括成員資格測試（Membership Tests）和身份測試（Identity Tests）。
- `|`：按位或
- `^`：按位異或
- `&`：按位與
- `<<, >>`：移動
- `+, -`：加與減
- `*, /, //, %`：乘、除、整除、取余
- `+x, -x, ~x`：正、負、按位取反
- `**`：求冪
- `x[index], x[index:index], x(arguments...), x.attribute`：下標、切片、調用、屬性引用
- `(expressions...), [expressions...], {key: value...}, {expressions...}`：顯示綁定或陣列、顯示列表、顯示字典、顯示設置

我們還沒有遇到的運算符將在後面的章節中加以解釋。

在上表中位列同一行的運算符具有_相同優先級_。例如 `+` 和 `-` 就具有相同的優先級。

## 改變運算順序 {#changing-order-of-evaluation}

為了使運算式更加易讀，我們可以使用括弧。舉個例子，`2 + (3 * 4)` 自是要比 `2 + 3 * 4` 要更加容易理解，因為後者還要求你要了解運算符的優先級。和其他的一切一樣，使用括弧同樣也要適度（而不要過度），同時亦應不要像 `(2 + (3 * 4))` 這般冗余。

使用括弧還有一個額外的優點——它能幫助我們改變運算的順序。同樣舉個例子，如果你希望在運算式中計算乘法之前應先計算加法，那麼你可以將運算式寫作 `(2 + 3) * 4`。

## 關聯性[^9]

運算符通常由左至右相互關聯。這意味著具有相同優先級的運算符將從左至右的方式依次進行求值。如 `2 + 3 + 4` 將會以 `(2 + 3) +4` 的形式加以計算。

## 運算式

案例（將其保存為 `expression.py`）：

```python
length = 5
breadth = 2

area = length * breadth
print('Area is', area)
print('Perimeter is', 2 * (length + breadth))
```

輸出：

```
$ python expression.py
Area is 10
Perimeter is 14
```

**它是如何工作的**

矩形的長度（Length）與寬度（Breadth）存儲在以各自名稱命名的變量中。我們使用它們並借助運算式來計算矩形的面積（Area）與周長（Perimeter）。我們將運算式 `length * breadth` 的結果存儲在變量 `area` 中並將其通過使用 `print` 函數列印出來。在第二種情況中，我們直接在 `print` 函數中使用了運算式 `2 * (length + breadth)` 的值。

同時，你需要注意到 Python是如何_漂亮地列印出_ 輸出結果的。盡管我們沒有特別在 `Area is` 和變量 `area` 之間指定空格，Python 會幫我們加上所以我們就能得到一個整潔的輸出結果，同時程式也因為這樣的處理方式而變得更加易讀（因為我們不需要在用以輸出的字串中考慮空格問題）。這便是一個 Python 是如何讓程式員的生活變得更加便捷美好的範例。

## 總結

我們已經了解了如何使用運算符、運算元與運算式——這些是我們構建任何程式的基本塊。接下來，我們將看到如何在程式中善加利用這些語句。


----

[^1]: 按位與是針對二進制數的操作，指將兩個二進制數的每一位都進行比較，如果兩個相應的二進位都為 1 則此位為 1，否則為 0。在本例中，`5` 的二進制表達為 `101`，`3` 的二進制表達為 `11`（為補全位數進行按位操作寫作 `011`），則按位與操作後的結果為 `001`，對應的十進制數為 `1`。

[^2]: 按位或是針對二進制數的操作，指將兩個二進制數的每一位都進行比較，如果兩個相應的二進位有一個為 1 則此位為 1，否則為 0。在本例中，`101` 與 `011` 進行按位或操作後的結果為 `111`，對應十進制數為 `7`。

[^3]: 按位異或是針對二進制數的操作，指將兩個二進制數的每一位都進行比較，如果兩個相應的二進位不同則此位為 1，相同為 0。在本例中，`101` 與 `011` 進行按位異或操作的結果為 `110`，對應十進制數為 `6`。

[^4]: 按位取反也稱作『按位取非』或『求非』或『取反』，沈潔元譯本譯作『按位翻轉』，是針對二進制數的操作，指將兩個二進制數的每一二進位都進行取反操作，`0` 換成 `1`，`1` 換成 `0`。受篇幅與學識所限，本例具體原理不在此處贅述。讀者只需按照給出的公式記憶即可。

[^5]: 原文作 Boolean NOT。

[^6]: 原文作 Boolean AND。

[^7]: 原文作 Boolean OR。

[^8]: 原文作 Evaluation Order。

[^9]: 原文作 Associativity，沈潔元譯本譯作『結合規律』。

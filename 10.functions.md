# 函數

函數（Functions）是指可重複使用的程式片段。它們允許你為某個代碼塊賦予名字，允許你通過這一特殊的名字在你的程式任何地方來運行代碼塊，並可重複任何次數。這就是所謂的*調用（Calling）*函數。我們已經使用過了許多內置的函數，例如 `len` 和 `range`。

函數概念可能是在任何不平凡的軟件（無論使用的是何種編程語言）中*最*重要的構建塊，所以我們接下來將在本章中探討有關函數的各個方面。

函數可以通過關鍵字 `def` 來定義。這一關鍵字後跟一個函數的*識別字*名稱，再跟一對圓括弧，其中可以包括一些變量的名稱，再以冒號結尾，結束這一行。隨後而來的語句塊是函數的一部分。下面的案例將會展示出這其實非常簡單：

案例（保存為 `functon1.py`）：

<pre><code class="lang-python">{% include "./programs/function1.py" %}</code></pre>

輸出：

<pre><code>{% include "./programs/function1.txt" %}</code></pre>

**它是如何工作的**

我們以上文解釋過的方式定義名為 `say_hello` 的函數。這個函數不使用參數，因此在括弧中沒有聲明變量。函數的參數只是輸入到函數之中，以便我可以傳遞不同的值給它，並獲得相應的結果。

要注意到我們可以兩次調用相同的函數，這意味著我們不必重新把代碼再寫一次。

## 函數參數[^1]

函數可以獲取參數，這個參數的值由你所提供，借此，函數便可以利用這些值來*做*一些事情。這些參數與變量類似，這些變量的值在我們調用函數時已被定義，且在函數運行時均已賦值完成。

函數中的參數通過將其放置在用以定義函數的一對圓括弧中指定，並通過逗號予以分隔。當我們調用函數時，我們以同樣的形式提供需要的值。要注意在此使用的術語——在定義函數時給定的名稱稱作_『形參』（Parameters）_，在調用函數時你所提供給函數的值稱作_『實參』（Arguments）_。

案例（保存為 `function_param.py`）：

<pre><code class="lang-python">{% include "./programs/function_param.py" %}</code></pre>

輸出：

<pre><code>{% include "./programs/function_param.txt" %}</code></pre>

**它是如何工作的**

在這里，我們將函數命名為 `print_max` 並使用兩個參數分別稱作 `a` 和 `b`。我們使用一個簡單的 `if...else` 語句來找出更大的那個數，並將它列印出來。

第一次調用函數 `print_max` 時，我們以實參的形式直接向函數提供這一數字。在第二次調用時，我們將變量作為實參來調用函數。`print_max(x, y)` 將使得實參 `x` 的值將被賦值給形參 `a`，而實參 `y` 的值將被賦值給形參 `b`。在兩次調用中，`print_max` 都以相同的方式工作。

## 局部變量[^2]

當你在一個函數的定義中聲明變量時，它們不會以任何方式與身處函數之外但具有相同名稱的變量產生關系，也就是說，這些變量名只存在于函數這一*局部（Local）*。這被稱為變量的*作用域（Scope）*。所有變量的作用域是它們被定義的塊，從定義它們的名字的定義點開始。

案例（保存為 `function_local.py`）：

<pre><code class="lang-python">{% include "./programs/function_local.py" %}</code></pre>

輸出：

<pre><code>{% include "./programs/function_local.txt" %}</code></pre>

**它是如何工作的**

當我們第一次列印出存在于函數塊的第一行的名為 `x` 的值時，Python 使用的是在函數聲明之上的主代碼塊中聲明的這一參數的值。

接著，我們將值 `2` 賦值給 `x`。`x` 是我們這一函數的局部變量。因此，當我們改變函數中 `x` 的值的時候，主代碼塊中的 `x` 則不會受到影響。

隨著最後一句 `print` 語句，我們展示出主代碼塊中定義的 `x` 的值，由此確認它實際上不受先前調用的函數中的局部變量的影響。

## `global` 語句 {#global-statement}

如果你想給一個在程式頂層的變量賦值（也就是說它不存在于任何作用域中，無論是函數還是類），那麼你必須告訴 Python 這一變量並非局部的，而是*全局（Global）*的。我們需要通過 `global` 語句來完成這件事。因為在不使用 `global` 語句的情況下，不可能為一個定義于函數之外的變量賦值。

你可以使用定義于函數之外的變量的值（假設函數中沒有具有相同名字的變量）。然而，這種方式不會受到鼓勵而且應該避免，因為它對于程式的讀者來說是含糊不清的，無法弄清楚變量的定義究竟在哪。而通過使用 `global` 語句便可清楚看出這一變量是在最外邊的代碼塊中定義的。

案例（保存為 `function_global.py`）：

<pre><code class="lang-python">{% include "./programs/function_global.py" %}</code></pre>

輸出：

<pre><code>{% include "./programs/function_global.txt" %}</code></pre>

**它是如何工作的**

`global` 語句用以聲明 `x` 是一個全局變量——因此，當我們在函數中為 `x` 進行賦值時，這一改動將影響到我們在主代碼塊中使用的 `x` 的值。

你可以在同一句 `global` 語句中指定不止一個的全局變量，例如 `global x, y, z`。

## 默認參數值 {#default-arguments}

對于一些函數來說，你可能為希望使一些參數*可選*並使用默認的值，以避免用戶不想為他們提供值的情況。默認參數值可以有效幫助解決這一情況。你可以通過在函數定義時附加一個賦值運算符（`=`）來為參數指定默認參數值。

要注意到，默認參數值應該是常數。更確切地說，默認參數值應該是不可變的——這將在後面的章節中予以更詳細的解釋。就目前來說，只要記住就行了。

案例（保存為 `function_default.py`）：

<pre><code class="lang-python">{% include "./programs/function_default.py" %}</code></pre>

輸出：

<pre><code>{% include "./programs/function_default.txt" %}</code></pre>

**它是如何工作的**

名為 `say` 的函數用以按照給定的次數列印一串字串。如果我們沒有提供一個數值，則將按照默認設置，只列印一次字串。我們通過為參數 `times` 指定默認參數值 `1` 來實現這一點。

在第一次使用 `say` 時，我們只提供字串因而函數只會將這個字串列印一次。在第二次使用 `say` 時，我們既提供了字串，同時也提供了一個參數 `5`，聲明我們希望*說（Say）*這個字串五次。

> *注意*
> 
> 只有那些位于參數列表末尾的參數才能被賦予默認參數值，意即在函數的參數列表中擁有默認參數值的參數不能位于沒有默認參數值的參數之前。
> 
> 這是因為值是按參數所處的位置依次分配的。舉例來說，`def func(a, b=5)` 是有效的，但 `def func(a=5, b)` 是*無效的*。

## 關鍵字參數[^3]

如果你有一些具有許多參數的函數，而你又希望只對其中的一些進行指定，那麼你可以通過命名它們來給這些參數賦值——這就是*關鍵字參數（Keyword Arguments）*——我們使用命名（關鍵字）而非位置（一直以來我們所使用的方式）來指定函數中的參數。

這樣做有兩大優點——其一，我們不再需要考慮參數的順序，函數的使用將更加容易。其二，我們可以只對那些我們希望賦予的參數以賦值，只要其他的參數都具有默認參數值。

案例（保存為 `function_keyword.py）：

<pre><code class="lang-python">{% include "./programs/function_keyword.py" %}</code></pre>

輸出：

<pre><code>{% include "./programs/function_keyword.txt" %}</code></pre>

**它是如何工作的**

名為 `func` 的函數有一個沒有默認參數值的參數，後跟兩個各自帶有默認參數值的參數。

在第一次調用函數時，`func(3, 7)`，參數 `a` 獲得了值 `3`，參數 `b` 獲得了值 `7`，而 `c` 獲得了默認參數值 `10`。

在第二次調用函數時，`func(25, c=24)`，由于其所處的位置，變量 `a` 首先獲得了值 25。然後，由于命名——即關鍵字參數——指定，變量 `c` 獲得了值 `24`。變量 `b` 獲得默認參數值 `5`。

在第三次調用函數時，`func(c=50, a=100)`，我們全部使用關鍵字參數來指定值。在這里要注意到，盡管 `a` 在 `c` 之前定義，但我們還是我們在變量 `a` 之前指定了變量 `c`。

## 可變參數[^4]

有時你可能想定義的函數里面能夠有_任意_數量的變量，也就是參數數量是可變的，這可以通過使用星號來實現（將下方案例保存為 `function_varargs.py`）：

<pre><code class="lang-python">{% include "./programs/function_varargs.py" %}</code></pre>

輸出：

<pre><code>{% include "./programs/function_varargs.txt" %}</code></pre>

**它是如何工作的**

當我們聲明一個諸如 `*param` 的星號參數時，從此處開始直到結束的所有位置參數（Positional Arguments）都將被收集並匯集成一個稱為『param』的元組（Tuple）。

類似地，當我們聲明一個諸如 `**param` 的雙星號參數時，從此處開始直至結束的所有關鍵字參數都將被收集並匯集成一個名為 `param` 的字典（Dictionary）。


我們將在[後面的章節](./data_structures.md#data-structures)探索有關元組與字典的更多內容。

## `return` 語句 {#return-statement}

`return` 語句用于從函數中*返回*，也就是中斷函數。我們也可以選擇在中斷函數時從函數中*返回一個值*。

案例（保存為 `function_return.py`）：

<pre><code class="lang-python">{% include "./programs/function_return.py" %}</code></pre>

輸出：

<pre><code>{% include "./programs/function_return.txt" %}</code></pre>

*它是如何工作的*

`maximum` 函數將會返回參數中的最大值，在本例中是提供給函數的數值。它使用一套簡單的 `if...else` 語句來找到較大的那個值並將其*返回*。

要注意到如果 `return` 語句沒有搭配任何一個值則代表著 `返回 None`。`None` 在 Python 中一個特殊的類型，代表著虛無。舉個例子， 它用于指示一個變量沒有值，如果有值則它的值便是 `None（虛無）`。

每一個函數都在其末尾隱含了一句 `return None`，除非你寫了你自己的 `return` 語句。你可以運行 `print(some_function())`，其中 `some_function` 函數不使用 `return` 語句，就像這樣：

```python
def some_function():
    pass
```

Python 中的 `pass` 語句用于指示一個沒有內容的語句塊。

> 提示：有一個名為 `max` 的內置函數已經實現了『找到最大數』這一功能，所以盡可能地使用這一內置函數。

## DocStrings

Python 有一個甚是優美的功能稱作*文檔字串（Documentation Strings）*，在稱呼它時通常會使用另一個短一些的名字*docstrings*。DocStrings 是一款你應當使用的重要工具，它能夠幫助你更好地記錄程式並讓其更加易于理解。令人驚嘆的是，當程式實際運行時，我們甚至可以通過一個函數來獲取文檔！

案例（保存為 `function_docstring.py`）：

<pre><code class="lang-python">{% include "./programs/function_docstring.py" %}</code></pre>

輸出：

<pre><code>{% include "./programs/function_docstring.txt" %}</code></pre>

**它是如何工作的**

函數的第一行邏輯行中的字串是該函數的 *文檔字串（DocString）*。這里要注意文檔字串也適用于後面相關章節將提到的[模組（Modules）](./11.modules.md#modules)與[類（Class）](./14.oop.md#oop) 。

該文檔字串所約定的是一串多行字串，其中第一行以某一大寫字母開始，以句號結束。第二行為空行，後跟的第三行開始是任何詳細的解釋說明。[^5]在此*強烈建議*你在有關你所有非凡功能的文檔字串中都遵循這一約定。

我們可以通過使用函數的 `__doc__`（注意其中的*雙下劃綫*）屬性（屬于函數的名稱）來獲取函數 `print_max` 的文檔字串屬性。只消記住 Python 將*所有東西*都視為一個物件，這其中自然包括函數。我們將在後面的[類（Class）](./14.oop.md#oop)章節討論有關物件的更多細節。

如果你曾使用過 Python 的 `help()` 函數，那麼你應該已經了解了文檔字串的用途了。它所做的便是獲取函數的 `__doc__` 屬性並以一種整潔的方式將其呈現給你。你可以在上方的函數中嘗試一下——只需在程式中包含 `help(print_max)` 就行了。要記住你可以通過按下 `q` 鍵來退出 `help`。

自動化工具可以以這種方式檢索你的程式中的文檔。因此，我*強烈推薦*你為你編寫的所有不平凡的函數配以文檔字串。你的 Python 發行版中附帶的 `pydoc` 命令與 `help()` 使用文檔字串的方式類似。

## 總結

我們已經了解了許多方面的函數，但我們依舊還未覆蓋到所有類型的函數。不過，我們已經覆蓋到了大部分你每天日常使用都會使用到的 Python 函數。

接下來，我們將了解如何創建並使用 Python 模組。



****

[^1]: 原文作 Function Parameters，沈潔元譯本譯作『函數形參』。Parameter 和 Argument 同時具有『參數』和『形參』或『實參』兩種譯法。一般來說，只有在存在形參實參二義關系時，才會特別翻譯成『形參』或『實參』。故此節標題 Parameter 作『參數』解。

[^2]: 原文作 Local Varibles。

[^3]: 原文作 Keyword Arguments，沈潔元譯本譯作『關鍵參數』。

[^4]: 原文作 VarArgs Parameters，VarArgs 來自于英文『可變的』『自變量（一譯變元，台譯引數，也可以理解成參數）』兩個英文單詞的結合，即 **Var**iable **Arg**uments。

[^5]: 此處指的是以英文撰寫的文檔字串內容。